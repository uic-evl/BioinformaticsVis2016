<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test</title>
    <!-- Stylesheets-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="src/css/main.css">
    <link rel="stylesheet" type="text/css" href="lib/css/d3.slider.css">

    <!-- Libraries-->
    <script   src="https://code.jquery.com/jquery-2.2.3.min.js"
              integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="
              crossorigin="anonymous"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="lib/js/d3.slider.js"></script>

</head>
<body onload="start()">

<!-- Source -->
<script src="src/js/main.js"></script>
<script src="src/js/utils.js"></script>

<script src="src/js/visualizations/one_dimension.js"></script>
<script src="src/js/visualizations/two_dimension.js"></script>
<script src="src/js/visualizations/third_dimension.js"></script>

<div class="container-fluid">

    <!--Top Row-->
    <div class="row">
        <!--First Column-->
        <div class="col-md-6">
            <svg id="probability"></svg>
        </div>

        <!--Second Column-->
        <div class="col-md-6">
            <!--First Row - Heatmap-->
            <div class="row">
                <div class="col-md-6">
                    <svg id="distribution1D"></svg>
                </div>
            </div>

            <!--Second Row - Controls-->
            <div class="row top-buffer">
                <!--First Column-->
                <div class="col-md-12">
                    <!--Time slider Row-->
                    <div class="row">
                        <div class="col-md-6">
                            <div id="timeSlider"></div>
                        </div>
                    </div>
                    <!--Button Column-->
                    <div id="buttons" class="row top-buffer" style="visibility: hidden">
                        <div class="col-md-6">
                            <input type="checkbox" name="timeCurves" > Show Time Curves <br/>
                            <input type="checkbox" name="peaks" > Show Peaks
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <svg id="heatmapAB"></svg>
        </div>
        <div class="col-md-4">
            <svg id="heatmapAC"></svg>
        </div>
        <div class="col-md-4">
            <svg id="heatmapBC"></svg>
        </div>
    </div>

</div>

<script>

    /************************************************************************************/
    function start() {

        var prob_div = d3.select("#probability");

        var oneD_svg = prob_div
                .attr("width",  prob_div.node().parentNode.clientWidth )
                .attr("height", Application.main_height)
                .append('g');

        var heatmapAB_div = d3.select("#heatmapAB");
        var heatmapAC_div = d3.select("#heatmapAC");
        var heatmapBC_div = d3.select("#heatmapBC");

        var twoD_AB_svg = heatmapAB_div
                .attr("width",  heatmapAC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var twoD_AC_svg = heatmapAC_div
                .attr("width",  heatmapAC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var twoD_BC_svg = heatmapBC_div
                .attr("width",  heatmapBC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var controlPanel_width = (Application.main_width- Application.margin*3) / 6;
        var controlPanel_height = Application.main_height - Application.margin*2;

        /************************************************************************************/
        // 1D projection

        Application.oneDV.initialize(oneD_svg);

        // 2D projection
        var pA = Application.twoDV();
        var pB = Application.twoDV();
        var pC = Application.twoDV();

        /************************************************************************************/
        /************************************************************************************/
        // load multiple files and draw
        queue()
        /*.defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pa_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pb_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pab_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pac_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pbc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pabc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/state_space.csv")
         */
                .defer(d3.csv, "Pa_t0-20.csv")
                .defer(d3.csv, "Pb_t0-20.csv")
                .defer(d3.csv, "Pc_t0-20.csv")
                .defer(d3.csv, "Pab_t0-20.csv")
                .defer(d3.csv, "Pac_t0-20.csv")
                .defer(d3.csv, "Pbc_t0-20.csv")
                .defer(d3.csv, "Pabc_t0-20.csv")
                .defer(d3.csv, "state_space.csv")
                .await(loadAll);

        function loadAll(error, Pa_t20, Pb_t20, Pc_t20, Pab_t20, Pac_t20, Pbc_t20, Pabc_t20, States) {
            if (error) {
                console.log(error);
            }

            /* save the data in the global context to avoid passing it around */
            Application.data["Pa"] = Pa_t20;
            Application.data["Pb"] = Pb_t20;
            Application.data["Pc"] = Pc_t20;

            Application.data["Pab"] = Pab_t20;
            Application.data["Pac"] = Pac_t20;
            Application.data["Pbc"] = Pbc_t20;
            Application.data["Pabc"] = Pabc_t20;

            pA.initialize(twoD_AB_svg, 'Pab');
            pB.initialize(twoD_AC_svg, 'Pac');
            pC.initialize(twoD_BC_svg, 'Pbc');

            var headerRow_states = Object.keys(States[0]);
            var headerRow_oneD = Object.keys(Pa_t20[0]);  // get keys from the first row
            var headerRow_twoD = Object.keys(Pab_t20[0]);  // get keys from the first row
            var headerRow_threeD = Object.keys(Pabc_t20[0]);

            var xMaxP = [];
            xMaxP[0] = d3.max(Pa_t20, function (d) { return +d[headerRow_oneD[0]]; });
            xMaxP[1] = d3.max(Pb_t20, function (d) { return +d[headerRow_oneD[0]]; });
            xMaxP[2] = d3.max(Pc_t20, function (d) { return +d[headerRow_oneD[0]]; });

            var xMax_oneD = d3.max(xMaxP);
            var yMax_oneD = d3.max([Application.utils.findMax(Pa_t20, headerRow_oneD, 1),
                        Application.utils.findMax(Pc_t20, headerRow_oneD, 1),
                        Application.utils.findMax(Pc_t20, headerRow_oneD, 1)]) + 0.01;

            var probMax2D = d3.max([Application.utils.findMax(Pab_t20, headerRow_twoD, 2),
                        Application.utils.findMax(Pac_t20, headerRow_twoD, 2),
                        Application.utils.findMax(Pbc_t20, headerRow_twoD, 2)]) + 0.01;

            var probMax3D = Application.utils.findMax(Pabc_t20, headerRow_threeD, 3);

            /************************************************************************************/
            // time slider
            var startingTime = 0;

            var timeX = d3.scale.linear().domain([0, Application.TimeStep-1])
                    .range([0, controlPanel_width - Application.margin*2]).clamp(true);

            function brushed(evt, value) {

                Application.currentTime = value;

                Application.oneDV.renderLineGraphs(headerRow_oneD);
                Application.oneDV.renderOneDHeatMaps(headerRow_oneD, probMax3D, xMaxP, xMax_oneD, yMax_oneD);

                pA.update2DHeatMap("Pab" , probMax2D, Application.currentTime);
                pB.update2DHeatMap("Pac" , probMax2D, Application.currentTime);
                pC.update2DHeatMap("Pbc" , probMax2D, Application.currentTime);
            }

            d3.select('#timeSlider')
                    .call(d3.slider()
                            .axis(d3.svg.axis().ticks(Application.TimeStep-1))
                            .min(startingTime)
                            .max(Application.TimeStep-1)
                            .step(1)
                            .on("slide", brushed));

            var buttons = d3.select("#buttons").style({visibility: 'visible'})
                    .selectAll('input')
                    .on('change', function(evt){

                        if(this.name == 'timeCurves'){

                            // flip the state
                            Application.show_projectionTwoD_time = !Application.show_projectionTwoD_time;
                            // render/remove the curves
                            pA.showCurves("Pab");
                            pB.showCurves("Pac");
                            pC.showCurves("Pbc");

                        }
                        else if(this.name == 'showPeaks')
                        {

                        }


                    });

            /************* Initial Render ********************************************/
            Application.oneDV.drawAxis(xMax_oneD, yMax_oneD);  // draw X/Y-axis

            Application.oneDV.renderLineGraphs(headerRow_oneD);
            Application.oneDV.renderOneDHeatMaps(headerRow_oneD, probMax3D, xMaxP, xMax_oneD, yMax_oneD);

            pA.draw2DHeatMap("Pab" ,probMax2D, Application.currentTime);
            pB.draw2DHeatMap("Pac", probMax2D, Application.currentTime);
            pC.draw2DHeatMap("Pbc", probMax2D, Application.currentTime);

        }  // end - loadAll()
    }
    /************************************************************************************/
</script>


</body>
</html>